<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${sessionMember != null && sessionMember.role.name() == 'ADMIN'} ? 'PETOPIA - Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏' : 'PETOPIA'">PETOPIA</title>
    <style>
        /* Reset and Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px 0;
        }

        .community {
            background: white;
            width: 414px;
            height: 852px;
            position: relative;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        /* Header Styles */
        .header {
            padding: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            background: white;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .back-button {
            cursor: pointer;
            padding: 20px;
        }

        .back-button img {
            width: 24px;
            height: 24px;
        }

        .petopia {
            font-size: 24px;
            font-weight: bold;
            color: #FF4081;
        }

        .icon-buttons {
            display: flex;
            gap: 15px;
        }

        .icon-button {
            cursor: pointer;
        }

        .icon-button img {
            width: 24px;
            height: 24px;
        }

        /* Post Content Styles */
        .post-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .post-header {
            margin-bottom: 20px;
        }

        .post-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .post-info {
            display: flex;
            align-items: center;
            gap: 15px;
            color: #666;
            font-size: 14px;
        }

        .post-content {
            margin: 20px 0;
            line-height: 1.6;
            color: #444;
        }

        .post-media {
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .post-image, .post-video {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
        }

        .post-video {
            background: #000;
        }

        /* ÎπÑÎîîÏò§ ÎûòÌçº Ïä§ÌÉÄÏùº */
        .video-wrapper {
            position: relative;
            width: 100%;
            cursor: pointer;
        }

        .video-wrapper video {
            width: 100%;
            pointer-events: none;
        }

        .modal video {
            pointer-events: all;
        }

        /* Post Author Link Style */
        .post-author-wrapper {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .post-author {
            font-weight: bold;
            color: #333;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 15px;
        }

        .post-author::before {
            font-size: 14px;
        }

        .post-author.user::before {
            content: "üë§";
        }

        .post-author.admin::before {
            content: "üëë";  /* Í¥ÄÎ¶¨ÏûêÏö© ÌäπÎ≥Ñ Ïù¥Î™®Ìã∞ÏΩò */
        }

        .post-author.clickable {
            cursor: pointer;
            background-color: #f0f0f0;
            transition: all 0.2s ease;
        }

        .post-author.clickable:hover {
            background-color: #e0e0e0;
            color: #FF4081;
            transform: translateY(-1px);
        }

        .tooltip {
            position: relative;
            background-color: #FF9EBB;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            white-space: nowrap;
            animation: float 2s ease-in-out infinite;
            display: inline-block;
            margin-left: 8px;
        }

        .tooltip::before {
            content: "";
            position: absolute;
            top: 50%;
            left: -6px;
            transform: translateY(-50%);
            border-width: 6px 6px 6px 0;
            border-style: solid;
            border-color: transparent #FF9EBB transparent transparent;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }

        /* Footer Styles */
        .footer {
            position: sticky;
            bottom: 0;
            width: 100%;
            height: 85px;
            background: #FFFFFF;
            border-top: 1px solid #EEEEEE;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0;
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .nav-item img {
            width: 24px;
            height: 24px;
            opacity: 0.5;
        }

        .nav-item.active img {
            opacity: 1;
        }

        .nav-item span {
            font-size: 12px;
            color: #666666;
        }

        .nav-item.active span {
            color: #0C098C;
            font-weight: 500;
        }

        /* Action Buttons */
        .post-actions {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .edit-button, .delete-button {
            border: none;
            padding: 8px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .edit-button {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
        }

        .edit-button::before {
            content: "‚úèÔ∏è";
            font-size: 14px;
        }

        .edit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
        }

        .delete-button {
            background: linear-gradient(135deg, #ff4081, #e63672);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 64, 129, 0.2);
        }

        .delete-button::before {
            content: "üóëÔ∏è";
            font-size: 14px;
        }

        .delete-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 64, 129, 0.3);
        }

        .admin-delete {
            background: linear-gradient(135deg, #9c27b0, #7b1fa2) !important;
            box-shadow: 0 4px 15px rgba(156, 39, 176, 0.2) !important;
        }

        .admin-delete:hover {
            box-shadow: 0 6px 20px rgba(156, 39, 176, 0.3) !important;
        }

        .admin-delete::before {
            content: "‚ö°" !important;
        }

        /* Î≤ÑÌäº ÌÅ¥Î¶≠ Ìö®Í≥º */
        .edit-button:active, .delete-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            color: #fff;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
        }

        .modal video {
            width: 100%;
            max-height: 90vh;
        }

        .modal img {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
        }

        /* User Profile Modal Styles */
        .profile-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            display: none;
        }

        .profile-modal.show {
            opacity: 1;
            visibility: visible;
            display: block;
        }

        .profile-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.7);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background-color: white;
            padding: 25px;
            border-radius: 20px;
            width: 320px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .profile-modal.show .profile-modal-content {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .profile-image {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            margin-right: 15px;
            background-color: #FFE5EE;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }

        .profile-name {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .profile-info {
            margin-bottom: 20px;
        }

        .profile-info-item {
            display: flex;
            align-items: center;
            margin: 12px 0;
            color: #666;
            font-size: 14px;
        }

        .profile-info-item strong {
            width: 100px;
            color: #FF4081;
        }

        .profile-pets {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .profile-pets-title {
            font-weight: bold;
            color: #FF4081;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .profile-pets-title::before {
            content: "üêæ";
        }

        .pet-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .pet-tag {
            background-color: #FFE5EE;
            color: #FF4081;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .chat-button {
            width: 100%;
            padding: 12px;
            background-color: #FF4081;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .chat-button:hover {
            background-color: #E63672;
        }

        .chat-button::before {
            content: "üíå";
        }

        .close-profile {
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            font-size: 24px;
            color: #999;
            transition: color 0.2s;
        }

        .close-profile:hover {
            color: #666;
        }
    </style>
</head>
<body>
    <div class="community">
        <!-- Header -->
        <div class="header">
            <div class="back-button" onclick="location.href='/board'">
                <img src="/images/arrow-left0.svg" alt="Îí§Î°úÍ∞ÄÍ∏∞">
            </div>
            <div class="icon-buttons">
                <div class="icon-button">
                    <img src="/images/notification0.svg" alt="ÏïåÎ¶º" onclick="location.href='/'">
                </div>
                <div class="icon-button">
                    <img src="/images/mypage.svg" alt="ÎßàÏù¥ÌéòÏù¥ÏßÄ" onclick="location.href='/'">
                </div>
            </div>
        </div>

        <!-- Post Content -->
        <div class="post-container">
            <div class="post-header">
                <h1 class="post-title" th:text="${board.title}">Í≤åÏãúÍ∏Ä Ï†úÎ™©</h1>
                <div class="post-info">
                    <div class="post-author-wrapper">
                        <!-- Í¥ÄÎ¶¨ÏûêÍ∞Ä ÏïÑÎãê ÎïåÎßå ÌÅ¥Î¶≠ Í∞ÄÎä•ÌïòÍ≥† Ìà¥ÌåÅ ÌëúÏãú -->
                        <span th:if="${board.member.role.name() != 'ADMIN'}" 
                              class="post-author clickable user" 
                              onclick="openProfileModal()" 
                              th:text="${board.member.name}">
                        </span>
                        <!-- Í¥ÄÎ¶¨ÏûêÏùº ÎïåÎäî ÌÅ¥Î¶≠ Î∂àÍ∞ÄÎä•ÌïòÍ≥† Ìà¥ÌåÅ ÏóÜÏùå -->
                        <span th:if="${board.member.role.name() == 'ADMIN'}" 
                              class="post-author admin"
                              th:text="${board.member.name}">
                        </span>
                        <span th:if="${board.member.role.name() != 'ADMIN'}" class="tooltip">ÎàåÎü¨ÏÑú Ï±ÑÌåÖ ÏãúÏûë! üí¨</span>
                    </div>
                    <span class="post-date" th:text="${board.insertDate}"></span>
                </div>
            </div>

            <div class="post-content" th:text="${board.content}">
                Í≤åÏãúÍ∏Ä ÎÇ¥Ïö©
            </div>

            <div class="post-media" th:if="${boardFiles != null}">
                <th:block th:each="file : ${boardFiles}">
                    <!-- Ïù¥ÎØ∏ÏßÄ -->
                    <img th:if="${file.fileRealName.toLowerCase().endsWith('.jpg') || 
                                file.fileRealName.toLowerCase().endsWith('.jpeg') || 
                                file.fileRealName.toLowerCase().endsWith('.png') || 
                                file.fileRealName.toLowerCase().endsWith('.gif')}"
                         class="post-image" 
                         th:src="@{'/uploads/' + ${file.fileSaveName}}" 
                         th:onclick="'openModal(this)'"
                         alt="Ï≤®Î∂Ä Ïù¥ÎØ∏ÏßÄ">
                    
                    <!-- ÎπÑÎîîÏò§ -->
                    <div class="video-wrapper" th:if="${file.fileRealName.toLowerCase().endsWith('.mp4') || 
                                  file.fileRealName.toLowerCase().endsWith('.webm') || 
                                  file.fileRealName.toLowerCase().endsWith('.ogg')}"
                         th:onclick="'openModal(this.querySelector(\'video\'))'">
                        <video class="post-video"
                               th:src="@{'/uploads/' + ${file.fileSaveName}}"
                               autoplay
                               loop
                               muted
                               playsinline
                               controls>
                            Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî ÎèôÏòÅÏÉÅ Ïû¨ÏÉùÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.
                        </video>
                    </div>
                </th:block>
            </div>

            <!-- ÏàòÏ†ï/ÏÇ≠Ï†ú Î≤ÑÌäº -->
            <div class="post-actions">
                <!-- ÏûëÏÑ±Ïûê Î≥∏Ïù∏Ïùº Îïå -->
                <th:block th:if="${isAuthor}">
                    <button class="edit-button" th:onclick="'confirmEdit(' + ${board.bIdx} + ')'">ÏàòÏ†ï</button>
                    <button class="delete-button" th:onclick="'deletePost(' + ${board.bIdx} + ')'">ÏÇ≠Ï†ú</button>
                </th:block>
                <!-- Í¥ÄÎ¶¨ÏûêÍ∞Ä Îã§Î•∏ ÏÇ¨ÎûåÏùò Í∏ÄÏùÑ Î≥º Îïå -->
                <th:block th:if="${isAdmin and !isAuthor}">
                    <button class="delete-button admin-delete" th:onclick="'confirmAdminDelete()'">Í¥ÄÎ¶¨Ïûê ÏÇ≠Ï†ú</button>
                </th:block>
            </div>
        </div>

        <!-- Modal -->
        <div class="modal" id="mediaModal">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div class="modal-content"></div>
        </div>

        <!-- User Profile Modal -->
        <div id="profileModal" class="profile-modal">
            <div class="profile-modal-content">
                <span class="close-profile" onclick="closeProfileModal()">&times;</span>
                <div class="profile-header">
                    <div class="profile-image">üêï</div>
                    <div class="profile-name" th:text="${board.member.name}"></div>
                </div>
                <div class="profile-info">
                    <div class="profile-info-item">
                        <strong>ÌôúÎèô Îì±Í∏â</strong>
                        <span>
                            <th:block th:if="${board.member.point >= 1000}">üèÜ Í≥®Îìú</th:block>
                            <th:block th:if="${board.member.point >= 500 && board.member.point < 1000}">ü•à Ïã§Î≤Ñ</th:block>
                            <th:block th:if="${board.member.point < 500}">ü•â Î∏åÎ°†Ï¶à</th:block>
                        </span>
                    </div>
                    <div class="profile-info-item">
                        <strong>ÏÇ∞Ï±Ö Í±∞Î¶¨</strong>
                        <span th:if="${board.member.point != null}" th:text="${board.member.point * 100 + 'm'}">0m</span>
                    </div>
                    <div class="profile-info-item">
                        <strong>ÏûëÏÑ± Í≤åÏãúÍ∏Ä</strong>
                        <span th:text="${board.member.boards.size() + 'Í∞ú'}">0Í∞ú</span>
                    </div>
                    <div class="profile-info-item">
                        <strong>Í∞ÄÏûÖÏùº</strong>
                        <span th:text="${#temporals.format(board.member.lastLoginDate, 'yyyyÎÖÑ MMÏõî ddÏùº')}"></span>
                    </div>
                </div>
                <div class="profile-pets">
                    <div class="profile-pets-title">Î∞òÎ†§ÎèôÎ¨º</div>
                    <div class="pet-list">
                        <th:block th:if="${not #lists.isEmpty(board.member.dogs)}">
                            <span class="pet-tag" th:each="dog : ${board.member.dogs}">
                                üêï <span th:text="${dog.name}"></span>
                            </span>
                        </th:block>
                        <th:block th:if="${#lists.isEmpty(board.member.dogs)}">
                            <span class="pet-tag">ÏïÑÏßÅ Îì±Î°ùÎêú Î∞òÎ†§ÎèôÎ¨ºÏù¥ ÏóÜÏñ¥Ïöî</span>
                        </th:block>
                    </div>
                </div>
                <button class="chat-button" onclick="startChat()">1:1 Ï±ÑÌåÖÌïòÍ∏∞</button>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="nav-item" onclick="location.href='/'">
                <img src="/images/home1.svg" alt="Ìôà">
                <span>Ìôà</span>
            </div>
            <div class="nav-item" onclick="location.href='/calendar'">
                <img src="/images/calendar0.svg" alt="Ï∫òÎ¶∞Îçî">
                <span>Ï∫òÎ¶∞Îçî</span>
            </div>
            <div class="nav-item" onclick="location.href='/walk'">
                <img src="/images/location0.svg" alt="ÏÇ∞Ï±Ö">
                <span>ÏÇ∞Ï±Ö</span>
            </div>
            <div class="nav-item active" onclick="location.href='/board'">
                <img src="/images/_3-user0.svg" alt="Ïª§ÎÆ§ÎãàÌã∞">
                <span>Ïª§ÎÆ§ÎãàÌã∞</span>
            </div>
            <div class="nav-item" onclick="toggleMenu()">
                <img src="/images/category0.svg" alt="Î©îÎâ¥">
                <span>Î©îÎâ¥</span>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        function confirmEdit(boardId) {
            if (confirm('Í≤åÏãúÍ∏ÄÏùÑ ÏàòÏ†ïÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                window.location.href = '/board/edit?id=' + boardId;
            }
        }

        function deletePost(boardId) {
            if (confirm('Ï†ïÎßêÎ°ú ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                fetch('/board/delete/' + boardId)
                    .then(response => {
                        if (response.ok) {
                            alert('Í≤åÏãúÍ∏ÄÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                            window.location.href = '/board';
                        } else {
                            response.text().then(text => alert(text));
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                    });
            }
        }

        function toggleMenu() {
            location.href = '/menu';
        }

        // Î™®Îã¨ Í¥ÄÎ†® Ìï®Ïàò
        const modal = document.getElementById('mediaModal');
        const modalContent = modal.querySelector('.modal-content');

        function openModal(element) {
            const clone = element.cloneNode(true);
            modalContent.innerHTML = '';
            modalContent.appendChild(clone);
            
            if (clone.tagName === 'VIDEO') {
                clone.setAttribute('controls', 'true');
                clone.removeAttribute('onclick');
            }
            
            modal.classList.add('show');
        }

        function closeModal() {
            modal.classList.remove('show');
            modalContent.innerHTML = '';
        }

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeModal();
            }
        });

        // ESC ÌÇ§Î°ú Î™®Îã¨ Îã´Í∏∞
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && modal.classList.contains('show')) {
                closeModal();
            }
        });

        // ÌîÑÎ°úÌïÑ Î™®Îã¨ Í¥ÄÎ†® Ìï®Ïàò
        function openProfileModal() {
            const modal = document.getElementById('profileModal');
            modal.style.display = 'block';
            // ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ Ïï†ÎãàÎ©îÏù¥ÏÖò Ï†ÅÏö©
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
            document.body.style.overflow = 'hidden';
        }

        function closeProfileModal() {
            const modal = document.getElementById('profileModal');
            modal.classList.remove('show');
            // Ïï†ÎãàÎ©îÏù¥ÏÖòÏù¥ ÎÅùÎÇú ÌõÑ display none Ï≤òÎ¶¨
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
            document.body.style.overflow = '';
        }

        // ÌîÑÎ°úÌïÑ Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
        document.getElementById('profileModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeProfileModal();
            }
        });

        function startChat() {
            // Ï±ÑÌåÖ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
            window.location.href = '/chat/room/' + [[${board.member.mIdx}]];
        }

        function confirmAdminDelete() {
            if(confirm('Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏúºÎ°ú Ïù¥ Í≤åÏãúÍ∏ÄÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                fetch('/board/delete/' + [[${board.bIdx}]])
                    .then(response => {
                        if (response.ok) {
                            alert('Í≤åÏãúÍ∏ÄÏù¥ Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏúºÎ°ú ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                            window.location.href = '/board';
                        } else {
                            response.text().then(text => alert(text));
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                    });
            }
        }
    </script>
</body>
</html>
